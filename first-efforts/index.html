<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>provoke ZFS corruption - Provoke ZFS corruption</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Provoke ZFS corruption</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Blog version of provoke_ZFS_corruption</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">First efforts <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active">provoke ZFS corruption</a>
</li>
                                    
<li>
    <a href="X86_trial_1/" class="dropdown-item">X86 trial one</a>
</li>
                                    
<li>
    <a href="X86_trial_2-elided/" class="dropdown-item">X86 trial ZFS from backports - elided syncoid output</a>
</li>
                                    
<li>
    <a href="X86_trial_2/" class="dropdown-item">X86 trial ZFS from backports</a>
</li>
                                    
<li>
    <a href="arm64_NVME_2.2.6-interesting/" class="dropdown-item">arm64 NVME 2.2.6 interesting</a>
</li>
                                    
<li>
    <a href="arm64_NVME_2.2.6-uninteresting/" class="dropdown-item">arm64 NVME 2.2.6 uninteresting</a>
</li>
                                    
<li>
    <a href="arm64_NVME_2.2.6/" class="dropdown-item">ARHM64 NVME ZFS 2.2.6</a>
</li>
                                    
<li>
    <a href="arm64_NVME_bullseye/" class="dropdown-item">ARM64 Pi CM4 test with older kernel</a>
</li>
                                    
<li>
    <a href="arm64_SATA_USB_trial/" class="dropdown-item">ARM64 SATA via ISB trial</a>
</li>
                                    
<li>
    <a href="initial-results/" class="dropdown-item">ARM64 Pi CM4 Initial Results</a>
</li>
                                    
<li>
    <a href="second-try/" class="dropdown-item">second try</a>
</li>
                                    
<li>
    <a href="syncoid-errors/" class="dropdown-item">syncoid errors</a>
</li>
                                    
<li>
    <a href="x86_SATA_Buster/" class="dropdown-item">X86 SATA testing with Buster</a>
</li>
                                    
<li>
    <a href="x86_trial_3/" class="dropdown-item">X86 third trial</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Methodology <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../methodology/" class="dropdown-item">methodology</a>
</li>
                                    
<li>
    <a href="../methodology/setup_2025-02-03/" class="dropdown-item">First methodology exploration</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="X86_trial_1/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-light">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#provoke-zfs-corruption" class="nav-link">provoke ZFS corruption</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#status" class="nav-link">Status</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#hardware" class="nav-link">Hardware</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#todo" class="nav-link">TODO</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="provoke-zfs-corruption">provoke ZFS corruption</h1>
<p>RE: <a href="https://github.com/openzfs/zfs/issues/12014">https://github.com/openzfs/zfs/issues/12014</a></p>
<p>Use two Raspberry Pis to attempt to provoke corruption in a reproducible way.</p>
<h2 id="status">Status</h2>
<ul>
<li>Testing has proceeded on a different X86_64 host with no success in reproducing the errors. The test platform used Debian Buster and the following combinations were tried:</li>
</ul>
<table>
<thead>
<tr>
<th>kernel</th>
<th>ZFS</th>
<th>notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>4.19</td>
<td>0.8.6</td>
<td></td>
</tr>
<tr>
<td>4.19</td>
<td>2.0.0</td>
<td></td>
</tr>
<tr>
<td>4.19</td>
<td>2.0.3</td>
<td></td>
</tr>
<tr>
<td>5.10</td>
<td>2.0.3</td>
<td>(versions in bug report)</td>
</tr>
</tbody>
</table>
<p>The last test has run for about 10 days and over 1100 <code>syncoid</code> loops and no corruption was produced.</p>
<ul>
<li><code>ARM64 - Pi CM4/8GB io</code> On the third startup it took about one day to produce corruption. The processes that resulted in corruption have been stopped and further snapshots disabled. That host has been shut down pending a decision for further action. Detail at <a href="second-try/#2024-12-18-success">second try</a>.</li>
<li><code>X86_64 - J1900 host iox86</code> Host has been running smoothly for over a day with no curruption reported. <a href="X86_trial_1/">progress</a>.</li>
<li><code>ARM64 - Pi 4B/4GB namtarri</code> Still in prep - pool at 33% capacity. <a href="arm64_SATA_USB_trial/">progress</a></li>
</ul>
<h2 id="hardware">Hardware</h2>
<p>Testing has expanded to several H/W platforms.</p>
<h3 id="arm64-pi-cm48gb-io">ARM64 - Pi CM4/8GB io</h3>
<ul>
<li>Pi CM4 on official IO Board booting from NVME SSD (sending host)</li>
<li>X86_64 host with non-encrypted single disk HDD pool. (receiving host)</li>
</ul>
<p>Corruption was produced with about a day of testing.</p>
<h3 id="x86_64-j1900-host-iox86">X86_64 - J1900 host iox86</h3>
<ul>
<li>1TB SATA SSD connected via ASMedia (on board) controller</li>
<li>Partitioned for OS (minimal) and remaining space divided between two partitions.</li>
<li>Send and receive operations are on the same host (as opposed to sending to a remote host.)</li>
</ul>
<p>Corruption has not yet been produced. If this continues for another day, the test will be modified to send to a remote host (as used with <code>io</code>.)</p>
<h3 id="arm64-pi-4b4gb-namtarri">ARM64 - Pi 4B/4GB namtarri</h3>
<ul>
<li>120GB SSD repartitioned to allow 90+GB for a ZFS pool.</li>
<li>Sending to the same X86_64 host as <code>io</code>.</li>
</ul>
<h2 id="todo">TODO</h2>
<ul>
<li>Continue polishing the scripts.</li>
<li>Try different ZFS versions.</li>
<li>Expand testing to more H/W variations and configurations.</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
